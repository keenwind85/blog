---
title: "[기획자의 개발 도전기] 순시미네 3편 - AI 추천부터 커뮤니티까지, 서비스에 살을 붙이다"
date: 2025-09-20
tags:
  - 바이브코딩
  - Flutter
  - Supabase
  - GeminiAI
  - 커뮤니티
---

# AI 추천부터 커뮤니티까지, 서비스에 살을 붙이다

## 지도만으로는 부족했다

[[앱 개발기 2편 - 전국 요양시설 데이터를 네이버 지도에 올리다|이전 편]]에서 지도에 전국 요양시설을 올리는 데 성공했다. 그런데 앱을 쓰는 사용자 입장에서 생각해보니, 지도에 마커가 잔뜩 있는 것만으로는 부족했다.

> "이 중에서 우리 어머니한테 맞는 곳은 어디야?"

시설이 수십 개 보이는데, 하나하나 탭해서 정보를 비교하라고? 기획자 시절에 늘 하던 말, "사용자가 한 번에 찾을 수 있게"를 내가 직접 해결해야 했다.

그래서 세 가지를 추가하기로 했다:

1. **AI 추천 챗봇** — 상황에 맞는 시설을 추천
2. **커뮤니티** — 사용자끼리 경험을 공유
3. **게이미피케이션** — 활동을 유도하는 동기부여 시스템

## Gemini AI로 시설 추천 챗봇 만들기

Google Gemini API를 활용해서 AI 추천 기능을 만들었다. 단순히 "AI에게 물어보기"가 아니라, **단계별 질문지 → 조건 필터 → AI 분석 → 추천 결과**라는 흐름이다.

```
[AI 추천 흐름]

1단계: 사전 질문지
  → 돌봄 대상자의 요양등급은?
  → 치매 여부는?
  → 원하는 시설 유형은? (요양원/주야간보호/방문요양)
  → 중요하게 생각하는 점은? (직원 비율/시설 환경/비용/위치)

2단계: 위치 기반 검색
  → 사용자 현재 위치 또는 지정 위치 기준
  → PostGIS로 반경 내 시설 조회
  → 조건에 맞는 시설 필터링

3단계: Gemini AI 분석
  → 필터링된 시설 데이터를 AI에게 전달
  → 사용자 조건과 시설 정보를 매칭하여 분석
  → 추천 이유와 함께 결과 반환

4단계: 결과 표시
  → 추천 시설 목록 (카드형)
  → 각 시설별 AI 요약 (강점, 주의점)
  → 시설 상세 화면으로 이동 가능
```

여기서 내가 가장 신경 쓴 건 **AI 요약의 실용성**이었다. 기획자 출신이다 보니 "사용자가 진짜 알고 싶은 건 뭘까"를 계속 생각했다. 평가 등급 A인 곳이 좋다는 건 누구나 아는데, **"왜 이 시설이 당신에게 맞는지"를 설명해주는 게 AI의 역할이라고 봤다.

예를 들어 "치매 어머니, 강남 근처, 비용보다 직원 비율 중시"라는 조건이면, AI가 "이 시설은 요양보호사 1인당 입소자 비율이 1:2.5로 평균(1:4) 대비 우수하고, 치매 전문 프로그램을 3개 운영 중입니다"라는 식으로 답한다. 데이터에 근거한 구체적인 추천이다.

시설 상세 화면에서도 **AI 시설 요약**(`AiFacilitySummaryScreen`)을 별도로 넣었다. 시설의 인력, 시설, 프로그램, 평가 데이터를 종합해서 한눈에 볼 수 있는 요약을 AI가 생성한다. 분석 결과는 Firestore에 캐싱해서, 같은 시설을 다시 조회하면 API를 재호출하지 않는다.

### 쿨타임 시스템 — AI 남용 방지

AI API는 비용이 든다. 사용자가 무한정 질문을 던지면 서버 비용이 기하급수적으로 늘어난다. 그래서 **쿨타임 시스템**을 넣었다.

```
AI 추천 1회 사용
  → 3분 쿨타임 시작
  → 하단 네비게이션 AI 탭에 카운트다운 표시
  → 쿨타임 중에는 새 추천 불가
  → SharedPreferences에 타임스탬프 저장 (앱 재시작해도 유지)
```

3분이라는 시간은 의도적이다. 너무 짧으면 무의미하고, 너무 길면 사용자가 이탈한다. 추천 결과를 읽고, 시설 상세를 확인하고, 다시 돌아오는 데 3분이면 적당하다는 판단이었다. 이런 건 기획자 감각이 통하는 영역이었다.

기술적으로는 `AiCooltimeService`를 싱글톤으로 만들고, `StreamController`로 카운트다운 상태를 브로드캐스트한다. 하단 네비게이션 바의 AI 탭 아이콘 위에 남은 시간이 실시간으로 표시된다. 사소한 디테일이지만, 이런 게 앱의 완성도를 올린다.

## 커뮤니티 — 사용자끼리 소통하는 공간

시설 검색은 혼자 하는 일이지만, 요양은 혼자 겪는 일이 아니다. "어머니 요양원 보내신 분 계세요?", "주야간보호센터 이용 후기 궁금합니다" — 이런 질문을 나눌 수 있는 공간이 필요했다.

### 카테고리 설계

커뮤니티 게시판을 하나만 만들면 글이 뒤죽박죽이 된다. 2단계 카테고리로 설계했다:

```
[1단계 카테고리]        [2단계 카테고리]
요양찾기 ──────────── 효도클럽, 돌봄 팁, 시설 리뷰
건강관리 ──────────── 운동, 식단, 건강정보
사랑방   ──────────── 일상, 고민, 유머
```

**"효도클럽"**은 우리만의 네이밍이다. 부모님을 위해 요양 정보를 찾는 사람들이 모이는 곳이라는 의미를 담았다. 디자이너와 여러 이름을 놓고 고민했는데, 이게 가장 따뜻한 느낌이었다.

### 커뮤니티 기술 스택

커뮤니티는 앱에서 가장 복잡한 기능이었다. 게시글 CRUD만 해도 여러 테이블이 엮이는데, 거기에 댓글, 좋아요, 이미지 업로드, 해시태그, 신고, 알림까지 붙으니 서비스 레이어가 4개로 늘었다.

| 서비스 | 역할 |
|--------|------|
| CommunityService | 게시글/댓글/좋아요 CRUD |
| CommunityCacheService | 메모리 캐시 (TTL 5분, 최대 100항목) |
| CommunityNotificationService | 댓글/좋아요 알림 |
| CommunityFirebaseIntegrationService | FCM 푸시 연동 |

여기서 재미있는 결정이 하나 있었다. 실시간 댓글 업데이트를 위해 **Supabase Realtime**을 썼다. 게시글 상세 화면에서 다른 사용자가 댓글을 달면 바로 보인다. Firestore의 실시간 리스너와 비슷한데, 이게 PostgreSQL 위에서 돌아간다는 게 신기했다.

이미지 업로드는 **Supabase Storage**를 사용했다. 10MB 제한을 걸고, 업로드 후 URL을 게시글에 저장하는 방식이다. 이미지 목록은 갤러리 뷰어(`ImageGalleryViewer`)로 볼 수 있게 하고, 캐싱도 `cached_network_image` 패키지로 처리했다.

한 가지 예상치 못한 이슈가 있었는데, **한국어 비속어 필터**다. 커뮤니티를 열면 부적절한 글이 올라올 수 있으니 `korean_profanity_filter` 패키지를 넣어서 게시글과 댓글 작성 시 필터링했다. 이건 기획 단계에서는 "욕설 필터 넣어주세요"라고 한 줄이었을 텐데, 직접 해보니 한국어 비속어의 변형(초성 욕, 자음 치환 등)까지 커버하는 게 생각보다 까다로웠다.

### 커뮤니티 푸시 알림

누군가 내 글에 댓글을 달거나 좋아요를 누르면 푸시 알림을 보내야 한다. 이건 **Supabase Edge Function**으로 구현했다.

```
커뮤니티 알림 흐름:

1. 사용자 A가 사용자 B의 글에 댓글 작성
2. Flutter → Supabase에 댓글 저장
3. Supabase Edge Function 트리거 (send-community-notification)
4. Edge Function:
   - B의 FCM 토큰 조회
   - FCM V1 API로 푸시 발송
   - Google OAuth2 서비스 계정 인증 사용
5. B의 기기에 푸시 알림 도착
```

Edge Function은 TypeScript(Deno)로 작성한다. Supabase에서 제공하는 서버리스 함수인데, FCM V1 API를 호출하려면 Google 서비스 계정으로 OAuth2 인증을 해야 한다. 이 부분이 가장 삽질을 많이 한 곳이다. FCM의 레거시 API는 서버 키 하나면 됐는데, V1 API는 서비스 계정 JSON에서 JWT를 생성하고, 이걸로 액세스 토큰을 받아서... 인증만 3일이 걸렸다.

## 게이미피케이션 — 씨앗에서 개화까지

커뮤니티를 만들어도 사용자가 글을 안 쓰면 의미 없다. 활동을 유도할 장치가 필요했다. 그래서 **레벨 시스템**을 넣었다.

```
점수 기반 레벨 시스템:

Lv.1 씨앗     (0-19점)   — 가입 직후
Lv.2 발아     (20-39점)  — 활동 시작
Lv.3 새싹     (40-59점)  — 꾸준한 참여
Lv.4 꽃봉오리 (60-79점)  — 활발한 활동
Lv.5 개화     (80-100점) — 핵심 사용자
```

레벨 이름은 디자이너와 함께 정했다. **식물의 성장**이라는 메타포가 요양 서비스의 "돌봄" 이미지와 잘 어울렸다. 각 레벨마다 프로필 배지 디자인이 다르고, 프로필 테두리 색상, 그라디언트 효과, 닉네임 애니메이션까지 커스터마이징된다.

점수는 이렇게 쌓인다:

| 활동 | 점수 | 일일 제한 |
|------|------|----------|
| 자동 로그인 | +1 | 1회/일 |
| 글 작성 | +1 | 2회/일 |
| 댓글 작성 | +1 | 3회/일 |
| 즐겨찾기 추가 | +3 | - |
| 시설에 전화 | +5 | - |
| AI 요약 사용 | +5 | - |
| 첫 글 작성 | +3 | 최초 1회 |
| 글 삭제 | -1 | - |

일일 제한을 건 이유는 단순하다. 도배 방지. 하루에 글 100개 써서 점수를 올리는 건 막아야 하니까. 게다가 글을 삭제하면 점수가 깎인다. 이건 "쓰고 지우는" 어뷰징을 막기 위해서다. 이런 엣지 케이스를 미리 생각하는 건 기획자의 직업병이다.

DB에서는 PostgreSQL 트리거로 업적 달성을 자동 감지한다. 조회수 10/300/500 돌파, 좋아요 20개 달성 같은 마일스톤에 보너스 점수를 주고, Flutter에서는 레벨업/레벨다운 시 다이얼로그로 알려준다. `UserScoreService`가 실시간으로 점수 변동을 모니터링하고, 레벨 변경이 감지되면 축하(또는 위로) 메시지를 표시한다.

## 소셜 로그인 삼총사

한국 앱에서 소셜 로그인은 사실상 필수다. 카카오, 네이버, 애플 — 이 세 가지를 구현했다.

```
로그인 흐름:

카카오/네이버/애플 소셜 인증
  → social_id + social_type 획득
  → Supabase members 테이블에서 조회
  → 신규 회원? → 약관 동의 → 프로필 초기 설정 → 메인 화면
  → 기존 회원? → 바로 메인 화면
```

각 소셜 로그인마다 SDK가 다르고, 제공하는 사용자 정보도 다르다.

| 소셜 | 제공 정보 | 특이사항 |
|------|---------|---------|
| 카카오 | 이메일, 닉네임, 프로필 이미지 | 가장 풍부한 정보 제공 |
| 네이버 | 이메일, 이름, 성별, 생년 | 성별/생년까지 제공 |
| 애플 | 이름 (이메일은 숨기기 가능) | iOS 필수, 정보 최소 |

이걸 하나의 `members` 테이블로 통합하는 게 생각보다 까다로웠다. 어떤 소셜에서는 있고 어떤 소셜에서는 없는 필드를 nullable로 설계하고, 프로필 초기 설정 화면(`ProfileInitialSetupScreen`)에서 부족한 정보를 채우게 했다.

서비스 코드도 소셜별로 분리했다. `KakaoAuthService`, `NaverAuthService`, `AppleAuthService` — 각각의 SDK를 감싸는 래퍼 서비스를 만들고, 로그인 화면에서는 어떤 소셜이든 같은 인터페이스로 호출한다.

## 이번 편을 마치며

지도 위에 시설 데이터만 올려놓은 상태에서, AI 추천, 커뮤니티, 게이미피케이션, 소셜 로그인까지 붙이니 앱다운 앱이 됐다. 기능 하나를 추가할 때마다 Supabase 마이그레이션 파일이 늘어나고, 서비스 클래스가 추가되고, 화면이 생겼다. 결과적으로 마이그레이션 파일이 35개가 넘고, 화면이 25개 이상이 됐다.

기획자 시절에는 기능 목록을 스프레드시트에 정리하고 "이만큼 해주세요"라고 전달하면 끝이었다. 직접 만들어보니, 기능 하나가 테이블 설계 → API 작성 → 화면 구현 → 에러 처리라는 4단계를 거친다는 걸 몸으로 알게 됐다. 그리고 그 4단계 중 에러 처리가 가장 오래 걸린다는 것도.

다음 편에서는 이 앱을 실제 앱스토어에 올리기까지의 여정을 이야기하겠다. 코드를 완성하는 것과 스토어에 올리는 건 완전히 다른 일이었다.

---

> **이전 편**: [[앱 개발기 2편 - 전국 요양시설 데이터를 네이버 지도에 올리다]]
> **다음 편**: [[앱 개발기 4편 - 첫 앱을 앱스토어에 올리기까지]]
